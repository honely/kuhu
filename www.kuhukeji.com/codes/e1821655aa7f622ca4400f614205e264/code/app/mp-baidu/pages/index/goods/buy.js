(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/goods/buy"],{"036b":function(t,s,i){"use strict";var e=function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("view",{staticClass:"buy-box",attrs:{_hid:0}},[i("view",{staticStyle:{position:"absolute",top:"0",bottom:"60px",left:"0",right:"0",overflow:"scroll"},attrs:{_hid:1}},[i("view",{staticClass:"addr-box",attrs:{_hid:2}},[t._ri(!(""!=t.model),3)?i("view",{staticClass:"no-addr",attrs:{_hid:3},on:{click:t.showAddressListListener}},[i("view",{staticClass:"na-lt",attrs:{_hid:4}},[]),i("text",{staticClass:"iconfont icon-btn_arrowr",attrs:{_hid:6}})]):t._e(),t._ri(!(""==t.model),7)?i("view",{staticClass:"show-addr",attrs:{_hid:7},on:{click:t.showAddressListListener}},[i("view",{staticClass:"lt-addr",attrs:{_hid:8}},[i("view",{staticClass:"t-info",attrs:{_hid:9}},[i("text",{attrs:{_hid:10}},[t._v(t._s(t.model.name),11)]),i("text",{attrs:{_hid:12}},[t._v(t._s(t.model.mobile),13)])]),i("view",{staticClass:"b-info",attrs:{_hid:14}},[t._v(t._s(t.model.address),15)])]),i("text",{staticClass:"iconfont icon-btn_arrowr",attrs:{_hid:16}})]):t._e()]),i("view",{staticClass:"item-goods",staticStyle:{"'margin-top":"12px"},attrs:{_hid:17}},[i("image",{staticClass:"g-img",attrs:{src:t.photo,_hid:18,_batrs:"src"}}),i("view",{staticClass:"g-cont",attrs:{_hid:19}},[i("view",{staticClass:"gc-name ellipsis-1",attrs:{_hid:20}},[t._v(t._s(t.goodsDetail.goods_name),21)]),i("view",{staticClass:"gc-sku",attrs:{_hid:22}},[i("view",{staticClass:"sku-cont ellipsis-02",attrs:{_hid:23}},[t._v(t._s(t.sku_desc),24)]),i("text",{attrs:{_hid:25}},[t._v("x"+t._s(t.num),26)])]),i("view",{staticClass:"gc-price",attrs:{_hid:27}},[i("text",{staticClass:"g-price",attrs:{_hid:28}},[t._v("¥"+t._s(t.price),29)])])])]),i("view",{staticClass:"order-info",attrs:{_hid:30}},[i("view",{staticClass:"item-order",attrs:{_hid:31},on:{click:t.showCouponListener}},[i("view",{staticClass:"o-lt",attrs:{_hid:32}},[]),i("view",{staticClass:"o-rt",attrs:{_hid:34}},[i("text",{staticClass:"or-desc",style:"color:"+(t.detail.pass_coupon&&t.detail.pass_coupon.length>0?t.couponModel?"#f00":"#000;":"#ccc;"),attrs:{_hid:35}},[t._v(t._s(t.detail.pass_coupon&&t.detail.pass_coupon.length>0?t.couponModel?"-¥"+t.couponModel.money:"请选择优惠券":"暂无可用"),36)]),i("text",{staticClass:"iconfont icon-btn_arrowr",attrs:{_hid:37}})])]),i("view",{staticClass:"item-order",staticStyle:{"border-bottom-width":"0"},attrs:{_hid:38}},[i("view",{staticClass:"o-lt",attrs:{_hid:39}},[t._v("是否使用余额支付(当前余额:￥"+t._s(t.detail.user_money)+")",40)]),i("view",{staticClass:"o-rt",attrs:{_hid:41}},[i("text",{staticClass:"iconfont icon-radio",class:1==t.user_money?"icon-selector_enable1 ":"icon-selector_disable1 ",style:"color:"+(1==t.user_money?"#ED3005":"#999999")+";",attrs:{_hid:42},on:{click:t.onUseMoneyListener}})])])]),i("view",{staticClass:"order-info",attrs:{_hid:43}},[i("view",{staticClass:"item-order",attrs:{_hid:44}},[i("view",{staticClass:"o-lt",attrs:{_hid:45}},[]),i("view",{staticClass:"o-rt",attrs:{_hid:47}},[t._v("¥"+t._s(t.detail.total_price),48)])]),i("view",{staticClass:"item-order",staticStyle:{"border-bottom-width":"0"},attrs:{_hid:49}},[i("view",{staticClass:"o-lt",attrs:{_hid:50}},[]),i("view",{staticClass:"o-rt",attrs:{_hid:52}},[i("text",{attrs:{_hid:53}},[t._v("¥"+t._s(t.detail.freight),54)])])])])]),i("view",{staticClass:"bottom-box",attrs:{_hid:55}},[i("view",{staticClass:"bb-lt",attrs:{_hid:56}},[i("text",{staticClass:"bb-price",attrs:{_hid:57}},[t._v("¥"+t._s(t.detail.need_price),58)]),i("view",{staticClass:"bb-detailed",attrs:{_hid:59},on:{click:t.showDetailedDialog}},[i("text",{attrs:{_hid:60}},[]),i("text",{staticClass:"iconfont icon-icon_arrowdown1",attrs:{_hid:62}})])]),i("view",{staticClass:"bb-rt",attrs:{_hid:63},on:{click:t.showPaymentDialog}},[t._v("结算("+t._s(t.detail.count)+")",64)])]),t._ri(!!t.showAddressFlag,65)?i("view",{staticClass:"mask",attrs:{_hid:65}},[i("view",{staticClass:"dialog-address",attrs:{_hid:66}},[i("view",{staticClass:"d-header",attrs:{_hid:67}},[i("text",{staticStyle:{flex:"1"},attrs:{_hid:68}},[]),i("text",{staticClass:"iconfont icon-btn_close_black",staticStyle:{"padding-left":"15px"},attrs:{_hid:70},on:{click:t.hideAddressListListener}})]),i("addressView",{attrs:{list:t.list,_hid:71,_batrs:"list",_cid:0},on:{selectEvent:t.selectAddrListener,deleteEvent:t.deleteCallBack}})],1)]):t._e(),i("LoadingView",{attrs:{img:t.imgBaseUrl+"/loading.gif",_hid:1073,_batrs:"img",_cid:1}}),i("ToastView",{attrs:{_hid:2075,_cid:2}}),t._ri(!!t.showCouponFlag,3077)?i("view",{staticClass:"mask",attrs:{_hid:3077}},[i("view",{staticClass:"dialog-detailed",attrs:{_hid:3078}},[i("view",{staticClass:"dd-header",attrs:{_hid:3079}},[i("text",{staticClass:"h-tit",attrs:{_hid:3080}},[]),i("text",{staticClass:"h-close iconfont icon-btn_close_black",attrs:{_hid:3082},on:{click:t.hideCouponListener}})]),i("view",{staticClass:"coupon-list",staticStyle:{margin:"0"},attrs:{_hid:3083}},[i("uni-couponView",{attrs:{type:5,iData:t.detail.pass_coupon,_hid:3084,_batrs:"type,iData",_cid:3},on:{selectCoupon:t.selectCouponListener}})],1)])]):t._e(),t._ri(!!t.paymentFlag,4086)?i("view",{staticClass:"mask",attrs:{_hid:4086}},[i("view",{staticClass:"dialog-detailed",attrs:{_hid:4087}},[i("view",{staticClass:"dd-header",attrs:{_hid:4088}},[i("text",{staticClass:"h-tit",attrs:{_hid:4089}},[]),i("text",{staticClass:"h-close iconfont icon-btn_close_black",attrs:{_hid:4091},on:{click:t.hidePaymentDialog}})]),i("view",{staticClass:"dd-payment",attrs:{_hid:4092}},[i("view",{staticClass:"item-payment",attrs:{"data-type":"weixin",_hid:4093},on:{click:t.paymentListener}},[t._m(0),i("text",{staticClass:"p-radio iconfont",class:"weixin"==t.pay_type?" icon-selector_enable":"icon-selector_disable",style:"color:"+("weixin"==t.pay_type?"#3A96E6":"#EDEDED"),attrs:{_hid:4098}})]),i("view",{staticClass:"item-payment",attrs:{"data-type":"ali",_hid:4099},on:{click:t.paymentListener}},[t._m(1),i("text",{staticClass:"p-radio iconfont",class:"ali"==t.pay_type?" icon-selector_enable":"icon-selector_disable",style:"color:"+("ali"==t.pay_type?"#3A96E6":"#EDEDED"),attrs:{_hid:4104}})])])])]):t._e(),t._ri(!!t.detailedFlag,4105)?i("view",{staticClass:"mask",attrs:{_hid:4105}},[i("view",{staticClass:"dialog-detailed",attrs:{_hid:4106}},[i("view",{staticClass:"dd-header",attrs:{_hid:4107}},[i("text",{staticClass:"h-tit",attrs:{_hid:4108}},[]),i("text",{staticClass:"h-close iconfont icon-btn_close_black",attrs:{_hid:4110},on:{click:t.hideDetailedDialog}})]),i("view",{staticClass:"dd-cont",attrs:{_hid:4111}},[t._l(t.detailedList,function(s,e,a){var o=void 0!==a?a:e;return i("view",{key:e,staticClass:"item-dcont",attrs:{_hid:4112,_fid:o,_fk:"i"}},[i("view",{staticClass:"d-name",attrs:{_hid:4113,_fid:o}},[t._v(t._s(s.goods_name),4114,o)]),i("view",{staticClass:"d-detail",attrs:{_hid:4115,_fid:o}},[i("view",{staticClass:"lt",attrs:{_hid:4116,_fid:o}},[i("text",{attrs:{_hid:4117,_fid:o}},[t._v("¥"+t._s(s.shop_price)+" x "+t._s(t.num),4118,o)]),t._ri(!!s.zhe,4119,void 0!==a?a:e)?i("text",{staticClass:"zhe",attrs:{_hid:4119,_fid:o}},[t._v(t._s(s.zhe)+"折",4120,o)]):t._e()]),i("view",{staticClass:"rt",attrs:{_hid:4121,_fid:o}},[t._v("¥"+t._s(s.zhe?s.dPrice/100:s.shop_price*t.num),4122,o)])])])},4112,t._self),i("view",{staticClass:"item-detail",attrs:{_hid:4123}},[i("view",{staticClass:"d-lt",attrs:{_hid:4124}},[]),i("view",{staticClass:"d-rt",staticStyle:{color:"#ED3005"},attrs:{_hid:4126}},[t._v("金额：-¥"+t._s(t.coupon_money),4127)])]),i("view",{staticClass:"item-detail",attrs:{_hid:4128}},[i("view",{staticClass:"d-lt",attrs:{_hid:4129}},[]),i("view",{staticClass:"d-rt",staticStyle:{color:"#ED3005"},attrs:{_hid:4131}},[t._v("优惠：-¥"+t._s(t.detail.money>0?t.detail.youhui_pric:0),4132)])]),i("view",{staticClass:"item-detail",attrs:{_hid:4133}},[i("view",{staticClass:"d-lt",attrs:{_hid:4134}},[]),i("view",{staticClass:"d-rt",attrs:{_hid:4136}},[t._v("¥"+t._s(t.detail.freight),4137)])]),i("view",{staticClass:"item-detail",attrs:{_hid:4138}},[i("view",{staticClass:"d-lt",attrs:{_hid:4139}},[]),i("view",{staticClass:"d-rt",staticStyle:{color:"#ED3005"},attrs:{_hid:4141}},[i("text",{attrs:{_hid:4142}},[]),i("text",{attrs:{_hid:4144}},[t._v(t._s(t.detail.need_price),4145)])])])],1)])]):t._e()],1)},a=[function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("view",{staticClass:"p-lt",attrs:{_hid:4094}},[i("text",{staticClass:"iconfont icon-icon_pay_wepay",staticStyle:{"font-size":"30px",color:"#41B035"},attrs:{_hid:4095}}),i("text",{staticStyle:{color:"#333333","font-size":"16px","margin-left":"15px"},attrs:{_hid:4096}},[])])},function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("view",{staticClass:"p-lt",attrs:{_hid:4100}},[i("text",{staticClass:"iconfont icon-icon_pay_alipay",staticStyle:{"font-size":"30px",color:"#00AAEE"},attrs:{_hid:4101}}),i("text",{staticStyle:{color:"#333333","font-size":"16px","margin-left":"15px"},attrs:{_hid:4102}},[])])}];i.d(s,"a",function(){return e}),i.d(s,"b",function(){return a})},"350c":function(t,s,i){"use strict";i("2346");var e=o(i("7f8f")),a=o(i("3a53"));function o(t){return t&&t.__esModule?t:{default:t}}e.default.mpType="page";var d=new a.default(e.default);d.$mount()},"578f":function(t,s,i){"use strict";i.r(s);var e=i("88f6"),a=i.n(e);for(var o in e)"default"!==o&&function(t){i.d(s,t,function(){return e[t]})}(o);s["default"]=a.a},"7f8f":function(t,s,i){"use strict";i.r(s);var e=i("036b"),a=i("578f");for(var o in a)"default"!==o&&function(t){i.d(s,t,function(){return a[t]})}(o);i("a760");var d=i("2877"),r=Object(d["a"])(a["default"],e["a"],e["b"],!1,null,null,null);s["default"]=r.exports},"88f6":function(t,s,i){"use strict";(function(t){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var e=a(i("0eb2"));function a(t){return t&&t.__esModule?t:{default:t}}var o={data:function(){return{showAddressFlag:!1,model:"",list:[],goods:[],detail:{},detailedFlag:!1,detailedList:[],user_money:0,pay_type:"",paymentFlag:!1,spec_key:"",num:0,goods_id:"",user_coupon_id:"",couponModel:"",coupon_money:0,goodsDetail:"",sku_desc:"",photo:"",price:"",showCouponFlag:!1,payOrderId:"",imgBaseUrl:""}},created:function(){this.$data.imgBaseUrl=this.wxb.imgBaseUrl},onLoad:function(t){console.log(t);var s=this;s.wxb.addPage(this),s.wxb.Init(t,function(i){var e=t.goods_id,a=t.num,o=t.spec_key,d=t.sku_desc;s.$data.goods_id=e,s.$data.num=a,s.$data.spec_key=o,s.$data.sku_desc=d,s.getGoodsDetail(),s.getDefaultAddress(),s.getAddressList(),s.getCheckOrderDetail()})},components:{addressView:e.default},onShow:function(){""!=this.$data.payOrderId&&setTimeout(function(){var s=this.$data.payOrderId;s&&t.redirectTo({url:"../../mine/order/detail?order_id="+s})},1e3)},onUnload:function(){this.wxb.removePage()},methods:{showCouponListener:function(t){console.log("显示优惠券弹窗");var s=this.$data.detail;s.pass_coupon&&s.pass_coupon.length>0&&(this.$data.showCouponFlag=!0)},hideCouponListener:function(t){this.$data.showCouponFlag=!1},selectCouponListener:function(t){var s=this.$data.detail.pass_coupon,i=s[t];this.$data.user_coupon_id=i.user_coupon_id,this.$data.couponModel=i,this.$data.coupon_money=i.money,this.hideCouponListener(),this.detail.need_price=this.detail.total_price+this.detail.freight-this.$data.couponModel.money},showPaymentDialog:function(s){this.$data.model&&this.$data.model.address_id?"h5"==this.wxb.device?this.$data.paymentFlag=!0:this.sureBuyListener():t.showToast({title:"请先选择收货地址"})},hidePaymentDialog:function(t){this.$data.paymentFlag=!1},paymentListener:function(t){var s=t.currentTarget.dataset.type;void 0!=s&&(this.$data.pay_type=s,this.sureBuyListener()),this.hidePaymentDialog()},showDetailedDialog:function(t){this.$data.detailedFlag=!0},hideDetailedDialog:function(t){this.$data.detailedFlag=!1},onUseMoneyListener:function(){0==this.$data.user_money?this.$data.user_money=1:this.$data.user_money=0},sureBuyListener:function(s){var i=this;i.wxb.Post("/shop/api.goodsbuy/payGoods",{goods_id:i.$data.goods_id,num:i.$data.num,spec_key:i.$data.spec_key,address_id:i.$data.model.address_id,user_coupon_id:i.$data.user_coupon_id,user_money:i.$data.user_money,user_note:"",pay_type:"h5"==i.wxb.device?i.$data.pay_type:""},function(s){if(0==s.is_pay)t.redirectTo({url:"../../mine/order/detail?order_id="+s.order_id});else if("h5"==i.wxb.device)if(i.$data.payOrderId=s.order_id,"weixin"==i.$data.pay_type)console.log("h5端支付跳转超链接"),window.location.href=s.order_info;else{var e=window.document.createElement("div");e.innerHTML=s.order_info,window.document.body.appendChild(e),window.document.forms.alipaysubmit.submit()}else i.wxb.paymentOrder(s,function(i){console.log(s);var e=s.order_id;t.redirectTo({url:"../../mine/order/detail?order_id="+e})});i.$data.pay_type=""})},getGoodsDetail:function(){var t=this;t.wxb.Post("/shop/api.goods/detail",{goods_id:t.$data.goods_id,comment_type:"1",page:1},function(s){if(t.$data.goodsDetail=s.detail,t.$data.goods=[],t.$data.goods.push(s.detail),0==s.detail.spec.length)t.$data.photo=s.detail.photos[0],t.$data.price=s.detail.shop_price;else for(var i in s.detail.spec_goods_price)console.log("key=>"+i),console.log("spec_key=>"+t.$data.spec_key),i==t.$data.spec_key&&(t.$data.photo=s.detail.spec_goods_price[i].photo,t.$data.price=s.detail.spec_goods_price[i].shop_price);""==t.$data.photo&&s.detail.photos.length>0&&(t.$data.photo=s.detail.photos[0])})},selectAddrListener:function(t){this.$data.list;this.$data.model=JSON.parse(t),console.log(this.$data.model),this.getCheckOrderDetail(),this.hideAddressListListener()},showAddressListListener:function(){this.$data.showAddressFlag=!0},hideAddressListListener:function(){this.$data.showAddressFlag=!1,""==this.$data.model&&this.getDefaultAddress(),this.getAddressList()},deleteCallBack:function(t){this.getAddressList()},getDefaultAddress:function(t){var s=this;s.wxb.Post("/shop/api.address/getDefault",{},function(t){void 0!=t&&(s.$data.model=t),void 0!=s.$data.model.address_id&&s.getCheckOrderDetail()})},getAddressList:function(t){var s=this;s.wxb.Post("/shop/api.address/getIndex",{},function(t){s.$data.list=t.list;var i=s.$data.model;for(var e in t.list)if(t.list[e].address_id==i.address_id)return;s.$data.model="",s.getDefaultAddress()})},getCheckOrderDetail:function(t){var s=this;s.wxb.Post("/shop/api.goodsbuy/getGoodsPrice",{goods_id:s.$data.goods_id,address_id:s.$data.model.address_id,user_coupon_id:s.$data.user_coupon_id,num:s.$data.num,spec_key:s.$data.spec_key,user_money:s.$data.user_money},function(t){s.$data.detail=t;var i=[];""!=t.youhui_info.coupon?i=t.youhui_info.coupon:""!=t.youhui_info.discount?i=t.youhui_info.discount:""!=t.youhui_info.manjian&&(i=t.youhui_info.manjian.goods);var e=JSON.parse(JSON.stringify(s.$data.goods));console.log("容器======"),console.log(e),console.log(i);var a=[];if(""!=i)for(var o in i)for(var d in console.log("d->"+i[o].goods_id),e)console.log("g->"+e[d].goods_id),i[o].goods_id==e[d].goods_id&&(console.log("找到商品了"),e[d].zhe=i[o]._discount,e[d].dPrice=i[o].discount_money,a.push(e[d]));else for(var d in e)a.push(e[d]);console.log(a),s.$data.detailedList=a})}}};s.default=o}).call(this,i("5486")["default"])},a760:function(t,s,i){"use strict";var e=i("c787"),a=i.n(e);a.a},c787:function(t,s,i){}},[["350c","common/runtime","common/vendor"]]]);