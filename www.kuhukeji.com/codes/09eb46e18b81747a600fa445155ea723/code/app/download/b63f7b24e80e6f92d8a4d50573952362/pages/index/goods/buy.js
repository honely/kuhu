(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/goods/buy"],{"350c":function(t,e,s){"use strict";s("2346");var i=o(s("b0ce")),a=o(s("7f8f"));function o(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(a.default))},"578f":function(t,e,s){"use strict";s.r(e);var i=s("88f6"),a=s.n(i);for(var o in i)"default"!==o&&function(t){s.d(e,t,function(){return i[t]})}(o);e["default"]=a.a},"7f8f":function(t,e,s){"use strict";s.r(e);var i=s("d953"),a=s("578f");for(var o in a)"default"!==o&&function(t){s.d(e,t,function(){return a[t]})}(o);s("a760");var d=s("2877"),n=Object(d["a"])(a["default"],i["a"],i["b"],!1,null,null,null);e["default"]=n.exports},"88f6":function(t,e,s){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(s("0eb2"));function a(t){return t&&t.__esModule?t:{default:t}}var o={data:function(){return{showAddressFlag:!1,model:"",list:[],goods:[],detail:{},detailedFlag:!1,detailedList:[],use_money:0,pay_type:"",paymentFlag:!1,spec_key:"",num:0,goods_id:"",user_coupon_id:"",couponModel:"",coupon_money:0,goodsDetail:"",sku_desc:"",photo:"",price:"",showCouponFlag:!1,payOrderId:"",imgBaseUrl:""}},created:function(){this.$data.imgBaseUrl=this.wxb.imgBaseUrl},onLoad:function(t){console.log(t);var e=this;e.wxb.addPage(this),e.wxb.Init(t,function(s){var i=t.goods_id,a=t.num,o=t.spec_key,d=t.sku_desc;e.$data.goods_id=i,e.$data.num=a,e.$data.spec_key=o,e.$data.sku_desc=d,e.getGoodsDetail(),e.getDefaultAddress(),e.getAddressList(),e.getCheckOrderDetail()})},components:{addressView:i.default},onShow:function(){""!=this.$data.payOrderId&&setTimeout(function(){var e=this.$data.payOrderId;e&&t.redirectTo({url:"../../mine/order/detail?order_id="+e})},1e3)},onUnload:function(){this.wxb.removePage()},methods:{showCouponListener:function(t){console.log("显示优惠券弹窗");var e=this.$data.detail;e.pass_coupon&&e.pass_coupon.length>0&&(this.$data.showCouponFlag=!0)},hideCouponListener:function(t){this.$data.showCouponFlag=!1},selectCouponListener:function(t){var e=this.$data.detail.pass_coupon,s=e[t];this.$data.user_coupon_id=s.user_coupon_id,this.$data.couponModel=s,this.$data.coupon_money=s.money,this.hideCouponListener(),this.detail.need_price=this.detail.total_price+this.detail.freight-this.$data.couponModel.money},showPaymentDialog:function(e){this.$data.model&&this.$data.model.address_id?"h5"==this.wxb.device?this.$data.paymentFlag=!0:this.sureBuyListener():t.showToast({title:"请先选择收货地址"})},hidePaymentDialog:function(t){this.$data.paymentFlag=!1},paymentListener:function(t){var e=t.currentTarget.dataset.type;void 0!=e&&(this.$data.pay_type=e,this.sureBuyListener()),this.hidePaymentDialog()},showDetailedDialog:function(t){this.$data.detailedFlag=!0},hideDetailedDialog:function(t){this.$data.detailedFlag=!1},onUseMoneyListener:function(){0==this.$data.use_money?this.$data.use_money=1:this.$data.use_money=0},sureBuyListener:function(e){var s=this;s.wxb.Post("/shop/api.goodsbuy/payGoods",{goods_id:s.$data.goods_id,num:s.$data.num,spec_key:s.$data.spec_key,address_id:s.$data.model.address_id,user_coupon_id:s.$data.user_coupon_id,use_money:s.$data.use_money,user_note:"",pay_type:"h5"==s.wxb.device?s.$data.pay_type:""},function(e){if(0==e.is_pay)t.redirectTo({url:"../../mine/order/detail?order_id="+e.order_id});else if("h5"==s.wxb.device)if(s.$data.payOrderId=e.order_id,"weixin"==s.$data.pay_type)console.log("h5端支付跳转超链接"),window.location.href=e.order_info;else{var i=window.document.createElement("div");i.innerHTML=e.order_info,window.document.body.appendChild(i),window.document.forms.alipaysubmit.submit()}else s.wxb.paymentOrder(e,function(s){console.log(e);var i=e.order_id;t.redirectTo({url:"../../mine/order/detail?order_id="+i})});s.$data.pay_type=""})},getGoodsDetail:function(){var t=this;t.wxb.Post("/shop/api.goods/detail",{goods_id:t.$data.goods_id,comment_type:"1",page:1},function(e){if(t.$data.goodsDetail=e.detail,t.$data.goods=[],t.$data.goods.push(e.detail),0==e.detail.spec.length)t.$data.photo=e.detail.photos[0],t.$data.price=e.detail.shop_price;else for(var s in e.detail.spec_goods_price)console.log("key=>"+s),console.log("spec_key=>"+t.$data.spec_key),s==t.$data.spec_key&&(t.$data.photo=e.detail.spec_goods_price[s].photo,t.$data.price=e.detail.spec_goods_price[s].shop_price);""==t.$data.photo&&e.detail.photos.length>0&&(t.$data.photo=e.detail.photos[0])})},selectAddrListener:function(t){this.$data.list;this.$data.model=JSON.parse(t),console.log(this.$data.model),this.getCheckOrderDetail(),this.hideAddressListListener()},showAddressListListener:function(){this.$data.showAddressFlag=!0},hideAddressListListener:function(){this.$data.showAddressFlag=!1,""==this.$data.model&&this.getDefaultAddress(),this.getAddressList()},deleteCallBack:function(t){this.getAddressList()},getDefaultAddress:function(t){var e=this;e.wxb.Post("/shop/api.address/getDefault",{},function(t){void 0!=t&&(e.$data.model=t),void 0!=e.$data.model.address_id&&e.getCheckOrderDetail()})},getAddressList:function(t){var e=this;e.wxb.Post("/shop/api.address/getIndex",{},function(t){e.$data.list=t.list;var s=e.$data.model;for(var i in t.list)if(t.list[i].address_id==s.address_id)return;e.$data.model="",e.getDefaultAddress()})},getCheckOrderDetail:function(t){var e=this;e.wxb.Post("/shop/api.goodsbuy/getGoodsPrice",{goods_id:e.$data.goods_id,address_id:e.$data.model.address_id,user_coupon_id:e.$data.user_coupon_id,num:e.$data.num,spec_key:e.$data.spec_key,use_money:e.$data.use_money},function(t){e.$data.detail=t;var s=[];""!=t.youhui_info.coupon?s=t.youhui_info.coupon:""!=t.youhui_info.discount?s=t.youhui_info.discount:""!=t.youhui_info.manjian&&(s=t.youhui_info.manjian.goods);var i=JSON.parse(JSON.stringify(e.$data.goods));console.log("容器======"),console.log(i),console.log(s);var a=[];if(""!=s)for(var o in s)for(var d in console.log("d->"+s[o].goods_id),i)console.log("g->"+i[d].goods_id),s[o].goods_id==i[d].goods_id&&(console.log("找到商品了"),i[d].zhe=s[o]._discount,i[d].dPrice=s[o].discount_money,a.push(i[d]));else for(var d in i)a.push(i[d]);console.log(a),e.$data.detailedList=a})}}};e.default=o}).call(this,s("543d")["default"])},a760:function(t,e,s){"use strict";var i=s("c787"),a=s.n(i);a.a},c787:function(t,e,s){},d953:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{staticClass:"buy-box"},[s("view",{staticStyle:{position:"absolute",top:"0",bottom:"60px",left:"0",right:"0",overflow:"scroll"}},[s("view",{staticClass:"addr-box"},[""==t.model?s("view",{staticClass:"no-addr",attrs:{eventid:"805dc028-0"},on:{click:t.showAddressListListener}},[s("view",{staticClass:"na-lt"},[t._v("选择收货地址")]),s("text",{staticClass:"iconfont icon-btn_arrowr"})]):t._e(),""!=t.model?s("view",{staticClass:"show-addr",attrs:{eventid:"805dc028-1"},on:{click:t.showAddressListListener}},[s("view",{staticClass:"lt-addr"},[s("view",{staticClass:"t-info"},[s("text",[t._v(t._s(t.model.name))]),s("text",[t._v(t._s(t.model.mobile))])]),s("view",{staticClass:"b-info"},[t._v(t._s(t.model.address))])]),s("text",{staticClass:"iconfont icon-btn_arrowr"})]):t._e()]),s("view",{staticClass:"item-goods",staticStyle:{"'margin-top":"12px"}},[s("image",{staticClass:"g-img",attrs:{src:t.photo}}),s("view",{staticClass:"g-cont"},[s("view",{staticClass:"gc-name ellipsis-1"},[t._v(t._s(t.goodsDetail.goods_name))]),s("view",{staticClass:"gc-sku"},[s("view",{staticClass:"sku-cont ellipsis-02"},[t._v(t._s(t.sku_desc))]),s("text",[t._v("x"+t._s(t.num))])]),s("view",{staticClass:"gc-price"},[s("text",{staticClass:"g-price"},[t._v("¥"+t._s(t.price))])])])]),s("view",{staticClass:"order-info"},[s("view",{staticClass:"item-order",attrs:{eventid:"805dc028-2"},on:{click:t.showCouponListener}},[s("view",{staticClass:"o-lt"},[t._v("优惠券")]),s("view",{staticClass:"o-rt"},[s("text",{staticClass:"or-desc",style:"color:"+(t.detail.pass_coupon&&t.detail.pass_coupon.length>0?t.couponModel?"#f00":"#000;":"#ccc;")},[t._v(t._s(t.detail.pass_coupon&&t.detail.pass_coupon.length>0?t.couponModel?"-¥"+t.couponModel.money:"请选择优惠券":"暂无可用"))]),s("text",{staticClass:"iconfont icon-btn_arrowr"})])]),s("view",{staticClass:"item-order",staticStyle:{"border-bottom-width":"0"}},[s("view",{staticClass:"o-lt"},[t._v("是否使用余额支付(当前余额:￥"+t._s(t.detail.user_money)+")")]),s("view",{staticClass:"o-rt"},[s("text",{staticClass:"iconfont icon-radio",class:1==t.use_money?"icon-selector_enable1 ":"icon-selector_disable1 ",style:"color:"+(1==t.use_money?"#ED3005":"#999999")+";",attrs:{eventid:"805dc028-3"},on:{click:t.onUseMoneyListener}})])])]),s("view",{staticClass:"order-info"},[s("view",{staticClass:"item-order"},[s("view",{staticClass:"o-lt"},[t._v("商品总额")]),s("view",{staticClass:"o-rt"},[t._v("¥"+t._s(t.detail.total_price))])]),s("view",{staticClass:"item-order",staticStyle:{"border-bottom-width":"0"}},[s("view",{staticClass:"o-lt"},[t._v("运费")]),s("view",{staticClass:"o-rt"},[s("text",[t._v("¥"+t._s(t.detail.freight))])])])])]),s("view",{staticClass:"bottom-box"},[s("view",{staticClass:"bb-lt"},[s("text",{staticClass:"bb-price"},[t._v("¥"+t._s(t.detail.need_price))]),s("view",{staticClass:"bb-detailed",attrs:{eventid:"805dc028-4"},on:{click:t.showDetailedDialog}},[s("text",[t._v("明细")]),s("text",{staticClass:"iconfont icon-icon_arrowdown1"})])]),s("view",{staticClass:"bb-rt",attrs:{eventid:"805dc028-5"},on:{click:t.showPaymentDialog}},[t._v("结算("+t._s(t.detail.count)+")")])]),t.showAddressFlag?s("view",{staticClass:"mask"},[s("view",{staticClass:"dialog-address"},[s("view",{staticClass:"d-header"},[s("text",{staticStyle:{flex:"1"}},[t._v("选择收货地址")]),s("text",{staticClass:"iconfont icon-btn_close_black",staticStyle:{"padding-left":"15px"},attrs:{eventid:"805dc028-6"},on:{click:t.hideAddressListListener}})]),s("addressView",{attrs:{list:t.list,eventid:"805dc028-7",mpcomid:"805dc028-0"},on:{selectEvent:t.selectAddrListener,deleteEvent:t.deleteCallBack}})],1)]):t._e(),s("LoadingView",{attrs:{img:t.imgBaseUrl+"/loading.gif",mpcomid:"805dc028-1"}}),s("ToastView",{attrs:{mpcomid:"805dc028-2"}}),t.showCouponFlag?s("view",{staticClass:"mask"},[s("view",{staticClass:"dialog-detailed"},[s("view",{staticClass:"dd-header"},[s("text",{staticClass:"h-tit"},[t._v("选择优惠券")]),s("text",{staticClass:"h-close iconfont icon-btn_close_black",attrs:{eventid:"805dc028-8"},on:{click:t.hideCouponListener}})]),s("view",{staticClass:"coupon-list",staticStyle:{margin:"0"}},[s("uni-couponView",{attrs:{type:5,iData:t.detail.pass_coupon,eventid:"805dc028-9",mpcomid:"805dc028-3"},on:{selectCoupon:t.selectCouponListener}})],1)])]):t._e(),t.paymentFlag?s("view",{staticClass:"mask"},[s("view",{staticClass:"dialog-detailed"},[s("view",{staticClass:"dd-header"},[s("text",{staticClass:"h-tit"},[t._v("选择支付方式")]),s("text",{staticClass:"h-close iconfont icon-btn_close_black",attrs:{eventid:"805dc028-10"},on:{click:t.hidePaymentDialog}})]),s("view",{staticClass:"dd-payment"},[s("view",{staticClass:"item-payment",attrs:{"data-type":"weixin",eventid:"805dc028-11"},on:{click:t.paymentListener}},[t._m(0),s("text",{staticClass:"p-radio iconfont",class:"weixin"==t.pay_type?" icon-selector_enable":"icon-selector_disable",style:"color:"+("weixin"==t.pay_type?"#3A96E6":"#EDEDED")})]),s("view",{staticClass:"item-payment",attrs:{"data-type":"ali",eventid:"805dc028-12"},on:{click:t.paymentListener}},[t._m(1),s("text",{staticClass:"p-radio iconfont",class:"ali"==t.pay_type?" icon-selector_enable":"icon-selector_disable",style:"color:"+("ali"==t.pay_type?"#3A96E6":"#EDEDED")})])])])]):t._e(),t.detailedFlag?s("view",{staticClass:"mask"},[s("view",{staticClass:"dialog-detailed"},[s("view",{staticClass:"dd-header"},[s("text",{staticClass:"h-tit"},[t._v("商品费用明细")]),s("text",{staticClass:"h-close iconfont icon-btn_close_black",attrs:{eventid:"805dc028-13"},on:{click:t.hideDetailedDialog}})]),s("view",{staticClass:"dd-cont"},[t._l(t.detailedList,function(e,i){return s("view",{key:i,staticClass:"item-dcont"},[s("view",{staticClass:"d-name"},[t._v(t._s(e.goods_name))]),s("view",{staticClass:"d-detail"},[s("view",{staticClass:"lt"},[s("text",[t._v("¥"+t._s(e.shop_price)+" x "+t._s(t.num))]),e.zhe?s("text",{staticClass:"zhe"},[t._v(t._s(e.zhe)+"折")]):t._e()]),s("view",{staticClass:"rt"},[t._v("¥"+t._s(e.zhe?e.dPrice/100:e.shop_price*t.num))])])])}),s("view",{staticClass:"item-detail"},[s("view",{staticClass:"d-lt"},[t._v("优惠券抵用")]),s("view",{staticClass:"d-rt",staticStyle:{color:"#ED3005"}},[t._v("金额：-¥"+t._s(t.coupon_money))])]),s("view",{staticClass:"item-detail"},[s("view",{staticClass:"d-lt"},[t._v("其他优惠")]),s("view",{staticClass:"d-rt",staticStyle:{color:"#ED3005"}},[t._v("优惠：-¥"+t._s(t.detail.money>0?t.detail.youhui_pric:0))])]),s("view",{staticClass:"item-detail"},[s("view",{staticClass:"d-lt"},[t._v("运费")]),s("view",{staticClass:"d-rt"},[t._v("¥"+t._s(t.detail.freight))])]),s("view",{staticClass:"item-detail"},[s("view",{staticClass:"d-lt"},[t._v("总额")]),s("view",{staticClass:"d-rt",staticStyle:{color:"#ED3005"}},[s("text",[t._v("¥")]),s("text",[t._v(t._s(t.detail.need_price))])])])],2)])]):t._e()],1)},a=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{staticClass:"p-lt"},[s("text",{staticClass:"iconfont icon-icon_pay_wepay",staticStyle:{"font-size":"30px",color:"#41B035"}}),s("text",{staticStyle:{color:"#333333","font-size":"16px","margin-left":"15px"}},[t._v("微信支付")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{staticClass:"p-lt"},[s("text",{staticClass:"iconfont icon-icon_pay_alipay",staticStyle:{"font-size":"30px",color:"#00AAEE"}}),s("text",{staticStyle:{color:"#333333","font-size":"16px","margin-left":"15px"}},[t._v("支付宝支付")])])}];s.d(e,"a",function(){return i}),s.d(e,"b",function(){return a})}},[["350c","common/runtime","common/vendor"]]]);